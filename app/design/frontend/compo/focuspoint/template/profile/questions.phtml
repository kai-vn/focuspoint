<?php
$helper = Mage::helper('profile');
$productId = $this->getProductId();
$brandId = $this->getBrand();
$data = $helper->getDataByBrand($brandId);
?>
<?php if (isset($data['glass'])): ?>
    <div class="info-container" id="glass-container" style="display:none">
        <input type="hidden" name="profile[glass]" id="profile-glass">
        <input type="hidden" name="profile[glass_price]" id="glass_price">
        <div class="title-question"><?php echo $this->__('Q2: Please Choose Glasses') ?></div>
        <div class="item-list">
            <?php
            foreach ($data['glass'] as $glass) :
                $glassId = $glass['glasses_id'];
                ?>
                <div class="item-profile item-glass"  id="item-glass-<?php echo $glassId ?>" onclick="changeGlass('<?php echo $glassId ?>')" >
                    <div class="item-info " data-id="<?php echo $glassId ?>">
                        <div class="item-title">
                            <div><?php echo $glass['title'] ?></div>
                            <div><?php echo $glass['subtitle'] ?></div>
                            <div class="item-tooltip" style="display:none"><?php echo $glass['tooltip'] ?></div>
                        </div>
                        <div class="item-description"><?php echo $glass['description'] ?></div>
                        <div class="item-price"><?php echo ((int) $glass['price'] != 0) ? '+RM' . $glass['price'] : 'Free' ?></div>
                    </div>
                </div>
            <?php endforeach; ?>
        </div>
    </div>
<?php endif; ?>
<?php if (isset($data['lens'])): ?>
    <div class="info-container" id="lens-container" style="display:none">
        <input type="hidden" name="profile[lens]" id="profile-lens">
        <input type="hidden" name="profile[lens_price]" id="lens_price">
        <div class="title-question"><?php echo $this->__('Q3: Please Choose Lens') ?></div>
        <div class="item-list">
            <?php
            foreach ($data['lens'] as $len) :
                $lenId = $len['lens_id'];
                ?>
                <div class="item-profile item-len" id="item-len-<?php echo $lenId ?>" onclick="changeLen('<?php echo $lenId ?>')"  >
                    <div class="item-info " data-id="<?php echo $lenId ?>" >
                        <div class="item-title">
                            <div><?php echo $len['title'] ?></div>
                            <div><?php echo $len['subtitle'] ?></div>
                        </div>
                        <div class="item-description"><?php echo $len['description'] ?></div>
                        <div class="item-price"><?php echo ((int) $len['price'] != 0) ? '+RM' . $len['price'] : 'Free' ?></div>
                    </div>
                </div>
            <?php endforeach; ?>
        </div>
    </div>
<?php endif; ?>
<?php if (isset($data['coating'])): ?>
    <div class="info-container" id="coating-container" style="display:none">
        <input type="hidden" name="profile[coating]" id="profile-coating">
        <input type="hidden" name="profile[coating_price]" id="coating_price">
        <div class="title-question"><?php echo $this->__('Q4: Please Choose Coating Add On') ?></div>
        <div class="item-list">
            <?php
            foreach ($data['coating'] as $coating) :
                $coatingId = $coating['coating_id'];
                ?>
                <div class="item-profile item-coating" id="item-coating-<?php echo $coatingId ?>" onclick="changeCoating('<?php echo $coatingId ?>')">
                    <div class="item-info " data-id="<?php echo $coatingId ?>" >
                        <div class="item-title">
                            <div><?php echo $coating['title'] ?></div>
                            <div><?php echo $coating['subtitle'] ?></div>
                        </div>
                        <div class="item-description"><?php echo $coating['description'] ?></div>
                        <div class="item-price"><?php echo ((int) $coating['price'] != 0) ? '+RM' . $coating['price'] : 'Free' ?></div>
                    </div>
                </div>
            <?php endforeach; ?>
        </div>
    </div>
<?php endif; ?>
<div><input type="hidden" name="profile[profile_cost]" id="profile_cost"></div>
<script type="text/javascript">
    // change glasses
    var data = <?php echo json_encode($data) ?>;
    var glass_price =0;
    var lens_price = 0;
    var coating_price = 0;
    var profile_cost = 0;
    
    function changeGlass(glassId) {
        $j('#profile-glass').val(glassId);
        profile_cost -= glass_price;
        glass_price = 0;
        glass_price = parseFloat(data.glass[glassId].price);
        profile_cost += glass_price;
        $j('#profile_cost').val(profile_cost);
        $j('#glass_price').val(glass_price)
        if ($j('#lens-container')) {
            $j('#lens-container').show();
        } else {
            if ($j('#coating-container')) {
                $j('#lens-container').show();
            }
        }
        $j('.item-glass').css('border', 'none');
        $j('#item-glass-' + glassId).css('border', '3px solid #cc1454');
    }
    function changeLen(lenId) {
        $j('#profile-lens').val(lenId);
        profile_cost -= lens_price;
        lens_price = 0;
        lens_price = parseFloat(data.lens[lenId].price);
        profile_cost += lens_price;
        $j('#lens_price').val(lens_price);
        $j('#profile_cost').val(profile_cost);
        if ($j('#coating-container')) {
            $j('#coating-container').show();
        }
        $j('.item-len').css('border', 'none');
        $j('#item-len-' + lenId).css('border', '3px solid #cc1454');
    }
    function changeCoating(coatingId) {
        $j('#profile-coating').val(coatingId);
        profile_cost -= coating_price;
        coating_price = 0;
        coating_price = parseFloat(data.coating[coatingId].price);
        profile_cost += coating_price;
        $j('#coating_price').val(coating_price);
        $j('#profile_cost').val(profile_cost);
        if ($j('#pres-container')) {
            $j('#pres-container').show();
        }
        $j('.item-coating').css('border', 'none');
        $j('#item-coating-' + coatingId).css('border', '3px solid #cc1454');
    }
</script>